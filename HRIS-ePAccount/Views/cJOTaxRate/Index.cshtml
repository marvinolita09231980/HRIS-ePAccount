@model HRIS_ePAccount.Models.User_Menu

@{
    ViewBag.Title = "Index";
}

<style type="text/css">
    /* Professional, compact layout for cJOTaxRate view - keeps IDs and bindings intact */
    .page-wrapper {
        max-width: 100%;
        /* reduce outer margin so content fits window more tightly */
        margin: 8px 10px;
        padding: 0 8px;
        font-family: "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }

    .gradient-header {
        background: linear-gradient(90deg,#507CD1 0%,#6a82e8 100%);
        color: #fff;
        /* reduced padding to fit header snugly */
        padding: 12px 16px;
        border-radius: 6px;
        display:flex;
        align-items:center;
        justify-content:space-between;
        gap:12px;
        /* remove extra margin so it sits flush inside wrapper */
        margin: 0;
    }

    .gradient-header h2 { margin:0; font-weight:700; font-size:1.45rem; }
    .breadcrumbs { color: rgba(255,255,255,0.9); font-size:0.95rem; }

    .card { background:#fff; border-radius:8px; /* smaller padding and vertical spacing to fit window */ padding:12px; box-shadow: 0 6px 18px rgba(15,34,62,0.06); margin: 8px 0; }

    .controls { display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
    .controls .left { display:flex; gap:12px; align-items:center; }
    .controls .right { margin-left:auto; display:flex; gap:8px; align-items:center; }

    .info-box { background:#f1f4fa; color:#2f5bb7; padding:8px 14px; border-radius:8px; font-weight:700; }

    .search-field { width:320px; max-width:100%; }
    .field-select-sm { height:36px; min-width:90px; }

    .table-responsive { margin-top:12px; }
    .table thead th { background:#f9fbff; color:#2f5bb7; font-weight:700; }

    .modal-header-add-edit { background: linear-gradient(90deg,#507CD1 0%,#6a82e8 100%); color:#fff; }
    .lbl_required { color:#d9534f; font-size:0.85rem; min-height:18px; display:block; margin-top:6px; }

    /* small screens adjustments */
    @@media (max-width: 768px) {
        .controls { flex-direction:column; align-items:stretch; }
        .controls .right { margin-left:0; justify-content:flex-end; }
    }

    /* preserve existing required class style usage */
    .required { border-color: red !important; }

    #toast-container { z-index: 999999 !important; }
</style>

<script src="~/Angular/ng-cJOTaxRate.js?v=@DateTime.Now.Ticks"></script>

<section class="page-wrapper" ng-app="ng_HRD_App" ng-controller="cJOTaxRate_ctrlr">

    <div class="gradient-header">
        <div>
            <h2>@Model.menu_name</h2>
            <div class="breadcrumbs">Home / Payroll / <strong>@Model.menu_name</strong></div>
        </div>

        <div style="display:flex; gap:12px; align-items:center;">
            <div class="info-box">Total: <span style="margin-left:8px;">{{datalistgrid.length || 0}}</span></div>
            @*<div class="info-box" style="background:#e9fbf0;color:#1f8a4a;">Active: <span style="margin-left:8px">{{active_count || 0}}</span></div>
            <div class="info-box" style="background:#fff6f6;color:#d9534f;">Inactive: <span style="margin-left:8px">{{inactive_count || 0}}</span></div>*@
        </div>
    </div>

    <div class="card">
        <div class="controls">
            <div class="left">
                <div>
                    <label style="font-weight:600; margin-right:8px;">Show</label>
                    <select id="ddl_show_entries" class="form-control field-select-sm" ng-model="rowLen" ng-change="setNumOfRow(rowLen,'datalist_grid')">
                        <option value="5">5</option>
                        <option value="10">10</option>
                        <option value="15">15</option>
                        <option value="20">20</option>
                    </select>
                </div>

                <div>
                    <label style="font-weight:600; margin-right:8px;">Payroll Year</label>
                    <select id="ddl_year" class="form-control field-select-sm" ng-model="ddl_year" ng-change="SelectPayrollYear(ddl_year)">
                        <option ng-repeat="yr in year" value="{{yr.year}}">{{yr.year}}</option>
                    </select>
                </div>

                <div>
                    <label style="font-weight:600; margin-right:8px;">Department</label>
                    <select id="ddl_department" class="form-control field-select-sm" ng-model="ddl_department" ng-change="SelectedDepartment_Change(ddl_department)">
                        <option value="">--Select Here--</option>
                        <option ng-repeat="lst in department_data" value="{{lst.department_code}}">{{lst.department_name1}}</option>
                    </select>
                </div>

                @* include history checkbox if allowed *@
                <div>
                    @if (Model.allow_edit_history == 1)
                    {
                        <label style="display:flex; gap:6px; align-items:center;"> <input type="checkbox" id="chckbx_history" ng-model="chckbx_history" ng-change="chckbx_history_Change(chckbx_history)" /> Include History </label>
                    }
                </div>
            </div>

            <div class="right">
                <input type="search" class="form-control search-field" ng-model="search_box" ng-keyup="search_in_list(search_box,'datalist_grid')" placeholder="Search..." />
                <button class="btn btn-light" title="Refresh" ng-click="btn_refresh_list()"><i id="btn_refresh_icon" class="fa fa-refresh"></i></button>
                @if (Model.allow_add == 1)
                {
                    <button class="btn btn-success" ng-show="btnAddShow" ng-click="btn_add_action()"><i id="btn_add" class="fa fa-plus-circle" style="margin-right:8px;"></i> Add</button>
                }
            </div>
        </div>

        <div style="margin-top:12px; display:flex; gap:8px; align-items:center;">
            <span ng-show="pending_gen_count > 0" ng-click="confirmRunPendingGeneration()" class="badge badge-warning" style="background:#ffefc6;color:#8a6d00;padding:8px 12px;border-radius:999px;cursor:pointer;"> <i class="fa fa-clock-o"></i> <b>{{pending_gen_count}}</b> pending</span>
            <span ng-show="failed_gen_count > 0" ng-click="confirmRetryFailedGeneration()" class="badge badge-danger" style="background:#fdecea;color:#b02a37;padding:8px 12px;border-radius:999px;cursor:pointer;"> <i class="fa fa-exclamation-triangle"></i> <b>{{failed_gen_count}}</b> failed</span>
        </div>
    </div>

    <div class="card">
        <div class="table-responsive">
            <table id="datalist_grid" class="table table-striped table-bordered table-hover" style="width:100%;">
                <thead>
                    <tr>
                        <th style="width:8%">ID NBR</th>
                        <th style="width:30%">EMPLOYEE NAME</th>
                        <th style="width:10%">BASIC TAX</th>
                        <th style="width:10%">ADDL. TAX</th>
                        <th style="width:10%">VAT</th>
                        <th style="width:12%">GROSS PAY</th>
                        <th style="width:15%">ACTION</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <!-- Main modal - keep original IDs and bindings -->
    <div class="modal fade" id="main_modal" data-toggle="modal" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="modalLabelSmall" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header modal-header-add-edit">
                    <h4 class="modal-title" id="modalLabelSmall">{{ModalTitle}}</h4>
                    <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body">

                    <div class="form-row">
                        <div class="form-group col-md-8">
                            <label>Employee's Name:</label>
                            <input id="txtb_empl_name" ng-show="isShowNameInput" ng-disabled="true" ng-model="txtb_empl_name" class="form-control" disabled />
                            <select id="ddl_employee_name" class="form-control select2_demo_3" ng-hide="isShowNameInput" ng-model="ddl_employee_name" style="width:100%;">
                                <option ng-repeat="lst in employeenames track by $index" ngx-data="{{$index}}" value="{{lst.empl_id}}">{{lst.employee_name}}</option>
                            </select>
                            <label id="lbl_ddl_employee_name_req" class="lbl_required"></label>
                        </div>

                        <div class="form-group col-md-4">
                            <label>ID Nbr.:</label>
                            <input id="txtb_empl_id" ng-disabled="true" ng-model="txtb_empl_id" class="form-control text-center" disabled />
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group col-md-8">
                            <label>Position:</label>
                            <input id="txtb_position" ng-disabled="true" ng-model="txtb_position" class="form-control" disabled />
                        </div>

                        <div class="form-group col-md-4">
                            <label>Effective Date:</label>
                            <input type="text" id="txtb_effective_date" ng-show="isShowEffectiveDate" onchange="RemoveEffective()" ng-model="txtb_effective_date" class="form-control text-center" />
                            <input id="txtb_effective_date_hid" ng-show="isShowEffectiveDate_hid" ng-disabled="true" ng-model="txtb_effective_date_hid" class="form-control text-center" disabled />
                            <label id="lbl_txtb_effective_date_req" class="lbl_required"></label>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group col-md-4">
                            <label>BIR Class:</label>
                            <select id="ddl_bir_class" class="form-control" ng-model="ddl_bir_class" ng-change="SelectBirClass(ddl_bir_class)">
                                <option value="">--Select Here--</option>
                                <option ng-repeat="lst in bir_class_data" value="{{lst.bir_class}}">{{lst.bir_class_descr}}</option>
                            </select>
                            <label id="lbl_ddl_bir_class_req" class="lbl_required"></label>
                        </div>

                        <div class="form-group col-md-4">
                            <label>Fixed Rate:</label>
                            <select id="ddl_fixed_rate" class="form-control" ng-model="ddl_fixed_rate" ng-change="SelectFixedRate(ddl_fixed_rate)">
                                <option value="">--Select Here--</option>
                                <option value="true">YES</option>
                                <option value="false">NO</option>
                            </select>
                            <label id="lbl_ddl_fixed_rate_req" class="lbl_required"></label>
                        </div>

                        <div class="form-group col-md-4">
                            <label>With Sworn:</label>
                            <select id="ddl_with_sworn" class="form-control" ng-model="ddl_with_sworn" ng-change="SelectWithSworn(ddl_with_sworn)">
                                <option value="">--Select Here--</option>
                                <option value="false" selected>NO</option>
                                <option value="true">YES</option>
                            </select>
                            <label id="lbl_ddl_with_sworn_req" class="lbl_required"></label>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group col-md-3">
                            <label>Basic Tax:</label>
                            <select id="ddl_w_held" class="form-control" ng-model="ddl_w_held">
                                <option value="0">0</option>
                                <option value="1">1%</option>
                                <option value="3">3%</option>
                                <option value="5">5%</option>
                                <option value="10">10%</option>
                                <option value="15">15%</option>
                            </select>
                        </div>

                        <div class="form-group col-md-3">
                            <label>Additional Tax:</label>
                            <select id="ddl_b_tax" class="form-control" ng-model="ddl_b_tax">
                                <option value="0">0</option>
                                <option value="1">1%</option>
                                <option value="3">3%</option>
                                <option value="5">5%</option>
                                <option value="10">10%</option>
                                <option value="15">15%</option>
                            </select>
                        </div>

                        <div class="form-group col-md-3">
                            <label>VAT:</label>
                            <select id="ddl_vat" class="form-control" ng-model="ddl_vat">
                                <option value="0">0</option>
                                <option value="1">1%</option>
                                <option value="3">3%</option>
                                <option value="5">5%</option>
                                <option value="8">8%</option>
                                <option value="10">10%</option>
                                <option value="15">15%</option>
                            </select>
                        </div>

                        <div class="form-group col-md-3">
                            <label>Exmpt. Amount:</label>
                            <input id="txtb_expt_amt" class="form-control text-right" ng-model="txtb_expt_amt" />
                            <label id="lbl_txtb_expt_amt_req" class="lbl_required"></label>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group col-md-4">
                            <label>Total Gross:</label>
                            <input id="txtb_gross_pay" class="form-control text-right" ng-model="txtb_gross_pay" disabled />
                        </div>

                        <div class="form-group col-md-4">
                            <label>Deduction Status:</label>
                            <select id="ddl_deduction_status" class="form-control" ng-model="ddl_deduction_status">
                                <option value="">--Select Here--</option>
                                <option value="true">ACTIVE</option>
                                <option value="false">IN-ACTIVE</option>
                            </select>
                            <label id="lbl_ddl_deduction_status_req" class="lbl_required"></label>
                        </div>

                        <div class="form-group col-md-4">
                            <label>Status:</label>
                            <select id="ddl_status" class="form-control" ng-model="ddl_status">
                                <option value="N" selected>NEW</option>
                                <option value="A">APPROVED</option>
                                <option value="R">REJECTED</option>
                            </select>
                            <label id="lbl_ddl_status_req" class="lbl_required"></label>
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal"><i class="fa fa-close"></i> Close</button>
                    <button ng-show="ishowsave" id="btn_save_tx_edit" ng-click="btn_save()" type="button" class="btn btn-success"><i id="btn_save" class="fa fa-save"></i> Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- loading modal -->
    <div class="modal fade" id="loading_data" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false" aria-hidden="true">
        <div class="modal-dialog modal-md modal-dialog-centered">
            <div class="spiner-example text-center" style="padding:22px;">
                <div class="sk-spinner sk-spinner-cube-grid" style="width:56px;height:56px;margin:0 auto;">
                    <div class="sk-cube"></div><div class="sk-cube"></div><div class="sk-cube"></div>
                    <div class="sk-cube"></div><div class="sk-cube"></div><div class="sk-cube"></div>
                    <div class="sk-cube"></div><div class="sk-cube"></div><div class="sk-cube"></div>
                </div>
                <div style="margin-top:12px;font-weight:600;">Loading, please wait…</div>
            </div>
        </div>
    </div>

</section>